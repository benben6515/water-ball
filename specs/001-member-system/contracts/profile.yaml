openapi: 3.0.3
info:
  title: Member System - Profile Management API
  description: User profile view and update endpoints
  version: 1.0.0
servers:
  - url: http://localhost:8080/api
    description: Development server
  - url: https://api.waterballsa.tw/api
    description: Production server

paths:
  /profile:
    get:
      summary: Get user profile
      description: Returns current user's profile information
      operationId: getProfile
      tags:
        - Profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      summary: Update user profile
      description: Updates user profile fields (nickname, gender, birthday, location, occupation, github_link)
      operationId: updateProfile
      tags:
        - Profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
              example:
                user_id: 550e8400-e29b-41d4-a716-446655440000
                nickname: John Doe
                email: john@example.com
                gender: 男
                birthday: 1990-01-15
                location: Taipei, Taiwan
                occupation: Software Engineer
                github_link: https://github.com/johndoe
                level: 5
                achievements:
                  - achievement_name: 黑段道館挑戰者
                    earned_at: "2025-11-10T10:30:00Z"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidGender:
                  value:
                    code: VALIDATION_ERROR
                    message: 性別必須為: 男, 女, 其他, 不透露
                    details:
                      field: gender
                      invalid_value: invalid
                invalidGithubUrl:
                  value:
                    code: VALIDATION_ERROR
                    message: 請輸入有效的 GitHub 網址
                    details:
                      field: github_link
                      invalid_value: not-a-url
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    UserProfile:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        nickname:
          type: string
          maxLength: 255
        email:
          type: string
          format: email
          description: From OAuth provider (read-only)
        gender:
          type: string
          enum: [男, 女, 其他, 不透露]
          nullable: true
        birthday:
          type: string
          format: date
          nullable: true
          example: "1990-01-15"
        location:
          type: string
          maxLength: 255
          nullable: true
        occupation:
          type: string
          maxLength: 255
          nullable: true
        github_link:
          type: string
          format: uri
          pattern: ^https://github\.com/[a-zA-Z0-9\-]+$
          nullable: true
          example: https://github.com/johndoe
        level:
          type: integer
          minimum: 1
          description: Gamification level (read-only)
        achievements:
          type: array
          items:
            $ref: '#/components/schemas/Achievement'
          description: User achievements (read-only)
      required:
        - user_id
        - nickname
        - email
        - level
        - achievements

    Achievement:
      type: object
      properties:
        achievement_id:
          type: string
          format: uuid
        achievement_type:
          type: string
        achievement_name:
          type: string
        earned_at:
          type: string
          format: date-time
      required:
        - achievement_id
        - achievement_type
        - achievement_name
        - earned_at

    UpdateProfileRequest:
      type: object
      properties:
        nickname:
          type: string
          minLength: 1
          maxLength: 255
        gender:
          type: string
          enum: [男, 女, 其他, 不透露]
          nullable: true
        birthday:
          type: string
          format: date
          nullable: true
        location:
          type: string
          maxLength: 255
          nullable: true
        occupation:
          type: string
          maxLength: 255
          nullable: true
        github_link:
          type: string
          format: uri
          pattern: ^https://github\.com/[a-zA-Z0-9\-]+$
          nullable: true
      required:
        - nickname

    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
      required:
        - code
        - message
